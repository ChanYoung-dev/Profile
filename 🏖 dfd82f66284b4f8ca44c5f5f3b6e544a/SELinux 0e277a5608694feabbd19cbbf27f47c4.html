<html><head><script src="../embed-sub.js" defer></script><link rel="stylesheet" href="../notion-mainstyle.css" /><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>SELinux</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: none;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
}

.simple-table-header {
	background: rgb(247, 246, 243);
	color: black;
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="0e277a56-0869-4fea-bbd1-9cbbf27f47c4" class="page sans"><header><div class="page-header-icon undefined"><img class="icon" src="Web%20encryption%205e0ae8625fa4497f9dd074c97b27ba34/kuber.png"/></div><h1 class="page-title">SELinux</h1></header><div class="page-body"><h1 id="6246fdbd-be02-4f23-a5eb-d6d01c1747c9" class="">SELinux</h1><ul id="0522103c-b28a-4e03-a386-742566d21756" class="bulleted-list"><li style="list-style-type:disc">기본 SELinux 보안 개념</li></ul><ul id="9db5b603-2c7a-45cf-825b-f485d39d954c" class="bulleted-list"><li style="list-style-type:disc">모든 파일, 프로세스, 디렉토리, 포트에는 특수 보안 레이블 존재</li></ul><ul id="5450e224-0488-49ca-8902-422b84f10c19" class="bulleted-list"><li style="list-style-type:disc">특수 보안 레이블에는 여러 컨텍스트가 존재<ul id="cdb01c9f-83df-4cfd-b0f1-cd1f2a270264" class="bulleted-list"><li style="list-style-type:circle">컨텍스트 종류 : 사용자, 역할, 유형, 민감도</li></ul><ul id="da969268-f3d0-4ccb-817c-761f7979a4c4" class="bulleted-list"><li style="list-style-type:circle">SELinux의 활성화되는 기본 정책인 타겟 정책은 세번째 컨텍스트인 유형 컨텍스트를 기준으로 규칙을 지정</li></ul><p id="27aa3be7-3a7c-4b04-91fd-9ef825a6eb42" class="">
</p></li></ul><h2 id="6ebb659a-85ba-4144-8a82-48ce1cc09061" class="">유형 컨텍스트</h2><p id="07116de5-48ca-4890-a11c-34bacd48904e" class="">유형 컨텍스트의 이름은 주로 <code>_t</code>로 끝남</p><ul id="e668f453-e061-41e1-a385-926678f27c4b" class="bulleted-list"><li style="list-style-type:disc">웹 서버의 유형 컨텍스트는 <code>httpd_t</code><ul id="ca859da3-6e06-44b4-b07f-b9ca4221972e" class="bulleted-list"><li style="list-style-type:circle"><code>/var/www/html</code>에서 일반적으로 발견되는 파일 및 디렉토리의 유형 컨텍스트<code>httpd_sys_content_t</code></li></ul></li></ul><ul id="1b689f75-f3bd-41cd-8ea8-e032af701026" class="bulleted-list"><li style="list-style-type:disc">MariaDB 서버의 유형 컨텍스트는 <code>mysqld_t</code><ul id="49425d17-3e2c-4bea-838e-74a9efb99b97" class="bulleted-list"><li style="list-style-type:circle"><code>/data/mysql</code>에서 일반적으로 발견되는 파일 및 디렉토리의 유형 : 컨텍스트는 <code>mysqld_db_t</code></li></ul><ul id="056edd62-b77b-408a-bc33-07a6a7d663a3" class="bulleted-list"><li style="list-style-type:circle"><code>/data/mysql</code> 하위 파일에 MariaDB 접근을 허용하지만 Apache 웹서비스와 같은 다른 서비스의 접근은 비활성화</li></ul></li></ul><p id="7994a27c-c6aa-43d8-8b5f-99250cc23548" class="">
</p><p id="da056c92-6d26-44d1-a537-6f2ecd40721e" class="">프로세스 유형 컨텍스트 확인 : <code>ps axZ</code></p><p id="8a4ef340-d82f-443b-ba17-ba30339e8b22" class="">
</p><h3 id="2a09ed56-2b86-4c6d-b69e-1125cc2c16e0" class=""><code>httpd</code> 프로세스 유형 컨텍스트 확인</h3><p id="927bfdde-b857-4445-9a0b-d3704b1623f5" class=""><code>systemctl start httpd</code></p><p id="537a95c7-22e3-4d41-9707-198570cc7b15" class=""><code>ps -ZC httpd</code></p><pre id="34b90443-d8e6-498c-80ff-a1b3cd0fb12f" class="code code-wrap"><code>[root@servera ~]# ps -ZC httpd
LABEL                             PID TTY          TIME CMD
system_u:system_r:httpd_t:s0     5072 ?        00:00:03 httpd
system_u:system_r:httpd_t:s0     5073 ?        00:00:00 httpd
system_u:system_r:httpd_t:s0     5074 ?        00:00:00 httpd
system_u:system_r:httpd_t:s0     5075 ?        00:00:00 httpd
system_u:system_r:httpd_t:s0     5076 ?        00:00:00 httpd
system_u:system_r:httpd_t:s0     5077 ?        00:00:00 httpd
system_u:system_r:httpd_t:s0     5146 ?        00:00:00 httpd
system_u:system_r:httpd_t:s0     5150 ?        00:00:00 httpd
system_u:system_r:httpd_t:s0     5152 ?        00:00:00 httpd
system_u:system_r:httpd_t:s0     5153 ?        00:00:00 httpd</code></pre><p id="601c5737-7f14-45a8-a0c3-d3fffe9b44fd" class="">
</p><h3 id="420e1661-1317-4aae-abb6-ae5246108f39" class=""><code>httpd</code> 관련 디렉토리 유형 컨텍스트 확인</h3><p id="b1609e96-21d1-4fe1-971c-8ca877184271" class=""><code>ls -Z /var/www</code></p><pre id="b5b66498-0d7b-44cc-827f-04f13339a857" class="code code-wrap"><code>[root@servera ~]# ls -Z /var/www
drwxr-xr-x. root root system_u:object_r:httpd_sys_script_exec_t:s0 cgi-bin
drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 html</code></pre><p id="c4986ec7-7bd3-4904-9e22-b17f5ab34201" class="">
</p><p id="03e30181-4f4e-4bd4-982e-311011baf58f" class=""><code>ls -dZ /var/www/html</code></p><pre id="e4deae3e-e8ac-4858-80a9-a1d6158899e6" class="code code-wrap"><code>[root@servera ~]# ls -dZ /var/www/html
drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /var/www/html</code></pre><p id="229da395-9c3a-483d-8dbc-cb01b90c8308" class="">
</p><h3 id="c55f1eb6-99b1-4d07-9a95-5bd079769864" class="">SELinux 동작 확인</h3><p id="86f27d26-7bee-4bf8-ab65-94df556d2286" class=""><code>getenforce</code></p><pre id="913cb7a8-38a9-4156-82a0-14a6edff8f9c" class="code code-wrap"><code>[root@servera ~]# getenforce
Enforcing</code></pre><p id="256cc358-ec2f-40ba-aa74-97c9fdfec257" class="">
</p><ul id="e5c1be46-938f-4c23-a4a0-b961066a3e29" class="bulleted-list"><li style="list-style-type:disc">동작 모드 설정</li></ul><p id="fc6d2f11-3c11-4f74-b575-6778fffbed00" class=""><code>setenforce 0</code> or <code>setenforce Permissive</code></p><p id="70a2e9e5-3046-4e34-aaf3-38d8fbc94afd" class=""><code>setenforce 1</code> or <code>setenforce Enforcing</code></p><p id="65527c25-10f1-4513-b97c-0adf0a0af65d" class="">
</p><ul id="1c32fa8a-dd33-4007-952b-20283eddcdf5" class="bulleted-list"><li style="list-style-type:disc">SELinux 설정 파일</li></ul><p id="141f63f0-019a-4014-8a7a-6fd54241e013" class=""><code>vim /etc/selinux/config</code></p><pre id="efc9ccf1-ec6f-4d59-adff-5d4864343b0c" class="code code-wrap"><code>...
SELINUX=enforcing
...</code></pre><p id="1c6515dd-21a2-430a-ae4d-7ac14714c60d" class="">
</p><ul id="de238f2d-21e2-43c3-ba66-81a9fc1ee161" class="bulleted-list"><li style="list-style-type:disc">동작 모드 3가지<p id="14ff7d75-4e90-4391-a576-33cbc33598b1" class=""><code>Enforcing</code> : 활성화</p><ul id="8b192c7f-9793-4a0b-83b3-83b5ab8ae30e" class="bulleted-list"><li style="list-style-type:circle">프로세스가 파일에 접근할 때 권한과 컨텍스트, 부울 등을 확인하여 차단</li></ul><p id="2191b8f7-397b-41e9-bd8d-572e0d4b591d" class=""><code>Permissive</code> : 활성화가 되어 있지만 SELinux 정책을 강제하지 않음</p><ul id="f361a493-e1bd-4c8d-8880-bf2124efcf98" class="bulleted-list"><li style="list-style-type:circle">프로세스가 파일에 접근할 때 권한과 컨텍스트, 부울 등을
확인하지만 정책을 위반하더라도 차단을 강제하지 않고 메세지만
로그에 기록</li></ul></li></ul><p id="e362101c-7a84-4d8b-96b8-1da4c8b64139" class="">
</p><h3 id="5e945aad-ebd8-4d82-a990-3a494a527dd6" class="">Disabled</h3><p id="5b8f5c27-adb9-4fce-b84a-9c981f6b05a6" class="">Disabled 설정은 <code>/etc/selinux/config</code> 파일에서 변경 가능</p><p id="aec27035-9de8-4508-b05d-c2e1a25b29c0" class="">Enforcing, Permissive 상태에서 Disabled로 모드 변경 시 또는 반대로 적용 시 재부팅 후 적용됨</p><p id="3c053e65-6af8-47e0-a129-a45bd113bfb0" class="">
</p><p id="2f7fb516-2c97-4079-8d1b-0ac22e0cb2a5" class="">
</p><h3 id="17a260ba-be5e-4444-808f-25bd818351da" class="">파일 유형 컨텍스트 확인</h3><p id="e9999763-068a-42bc-81dd-b889687ebbba" class=""><code>cp</code> 명령어로 복사 후 파일 유형 컨텍스트 확인</p><ol type="1" id="11e08389-17d7-48eb-a489-f71fa1c99e94" class="numbered-list" start="1"><li><code>touch httpd_fileA</code></li></ol><pre id="f9a82831-2ca5-40e0-b4c4-94d438c9aba7" class="code code-wrap"><code>[root@chan ~]# touch httpd_fileA
[root@chan ~]# ls -Z httpd_fileA
-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 httpd_fileA</code></pre><p id="9c09c429-b5fc-4168-ae6d-25d5d14e7ff9" class=""> 유형 컨텍스트 : <code>admin_home_t</code> 를 확인할 수 있다.</p><ol type="1" id="9fc49dc4-445d-4b3d-8cf4-3f8f3f85d134" class="numbered-list" start="2"><li><code>cp httpd_fileA /var/www/html/httpd_fileA_1</code></li></ol><pre id="f67de2ec-4a36-4125-97f4-e625eb03f213" class="code code-wrap"><code>[root@servera ~]# cp httpd_fileA /var/www/html/httpd_fileA_1
[root@servera ~]# ls -Z /var/www/html/httpd_fileA_1
-rw-r--r--. root root unconfined_u:object_r:httpd_sys_content_t:s0 /var/www/html/httpd_fileA_1</code></pre><p id="9c160864-58b6-41e1-a4f6-4fe9888bb844" class=""><code>/root</code> 디렉토리와 <code>/var/www/html</code> 의 유형 컨텍스트(<mark class="highlight-brown_background">httpd_sys_content_t</mark>)가 다르기 때문에 복사 후 <mark class="highlight-brown_background">다른 유형 컨텍스트</mark>가 적용된 것을 확인</p><ol type="1" id="71717040-23a4-4149-a19d-255c04e6aa2c" class="numbered-list" start="3"><li><code>cp -a</code> 명령어로 복사 후 파일 유형 컨텍스트 확인</li></ol><pre id="a26c8aa3-fb2f-4d40-9665-7b332930604b" class="code code-wrap"><code>[root@servera ~]# cp -a httpd_fileA /var/www/html/httpd_fileA_2
[root@servera ~]# ls -Z /var/www/html/httpd_fileA_2
-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 /var/www/html/httpd_fileA_2</code></pre><p id="3a87c628-e831-4556-9c60-c215d2349e48" class="">변한 것이 없다! 그대로 <code>admin_home_t</code> 이다. </p><p id="607e6de9-ea94-4ce9-8311-b0a2baf0a3da" class="">즉, <code>a</code> 옵션을 사용하여 복사 할 시 파일의 유형 컨텍스트가 바뀌지 않은 상태로 복사한다</p><p id="2aa5e195-3409-448e-9ca0-c657d72d0683" class="">httpd 프로세스가 접근을 할 수 없다</p><p id="3e6c918a-33f3-4306-b46a-8983c63e4416" class="">
</p><h2 id="c1f36056-0665-4eb5-b277-77844a55233c" class="">유형 컨텍스트 변경</h2><p id="d84e50f9-a2aa-4bcd-9ad5-fe8734b46a3d" class=""><code>semanage fcontext</code> : SELinux 관리 도구</p><p id="7a7b7a78-ad29-43ff-bef4-69b331898069" class="">
</p><p id="fce9051b-bdec-4730-b7e0-e2b42327b73b" class="">! semanage fcontext 사용을 위한 선행 작업</p><blockquote id="ca99f6ad-903e-402b-ba32-5b2cf1ad342d" class="">yum -y install policycoreutils-python</blockquote><p id="08c36928-cfe5-4211-a112-3eca238aabb8" class="">
</p><p id="cda540e7-4c84-416c-ad05-83ab76713a80" class="">디렉토리에 적용되어 있는 유형 컨텍스트 확인</p><p id="fdfb3e20-1f4b-4cf6-93da-6050d8366edd" class=""><code>semanage fcontext -l | grep /var/www</code></p><pre id="abeaf974-b0c8-4e17-a545-794318442f4d" class="code code-wrap"><code>[root@servera ~]# semanage fcontext -l | grep /var/www
/var/www(/.*)?                                     all files          system_u:object_r:httpd_sys_content_t:s0 
/var/www(/.*)?/logs(/.*)?                          all files          system_u:object_r:httpd_log_t:s0
...
...
/var/www/nut-cgi-bin/upsstats\.cgi                 regular file       system_u:object_r:nutups_cgi_script_exec_t:s0 
/var/www/gitweb-caching/gitweb\.cgi                regular file       system_u:object_r:git_script_exec_t:s0</code></pre><p id="f709d49a-689a-45cd-aa09-87101b41d3a0" class="">
</p><p id="bf8b5f29-521a-4656-88b0-05aed87e20d9" class="">
</p><p id="05e59255-1608-4f54-b167-cc5aebd655b5" class=""><code>mkdir /context</code></p><p id="9ccb1a74-8339-40ff-bc52-bafbc54148fd" class=""><code>ls -Zd /context</code></p><pre id="5c1b1311-db5e-4144-8529-7cae2d9c714c" class="code code-wrap"><code>[root@servera ~]# ls -Zd /context
drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 /context</code></pre><p id="9ee2c9ca-5750-4efa-a0a0-95ae242cac21" class="">/context 유형 컨텍스트를 확인할 수 있다</p><p id="87ad73e6-9dae-4c8b-9f19-71b90954fc15" class="">
</p><p id="ecb1279a-e1d6-484f-beed-ded1fb1e10ce" class="">유형 컨텍스트를 등록</p><p id="5ac73a35-2a3f-449b-89b6-aa53cdb3d3ed" class=""><code>semanage fcontext -a -t httpd_sys_content_t &#x27;/context(/.*)?&#x27;</code></p><pre id="7bfa04a4-364a-4ced-ab8d-8d274f228a21" class="code code-wrap"><code>[root@servera ~]# semanage fcontext -a -t httpd_sys_content_t &#x27;/context(/.*)?&#x27;
[root@servera ~]# ls -Zd /context
drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 /context</code></pre><p id="bba6ec7d-868b-4951-aae9-b6d776e8e768" class="">유형 컨텍스트 등록 후 해당 디렉토리에 적용X</p><p id="8c6a8c46-74dd-4d07-8149-6984d8d3c2c0" class="">
</p><p id="938b03e7-b67e-462b-8dee-f6700118b1f8" class="">유형 컨텍스트 적용</p><p id="9f1ac925-da4c-448c-b835-2584bd208fdf" class=""><code>restorecon -RFv /context</code></p><p id="5e862f53-d16d-469d-8a6f-561aef92c011" class="">restorecon reset /context context unconfined_u:object_r:default_t:s0-&gt;system_u:object_r:httpd_sys_content_t:s0</p><pre id="c9c3ee67-fe8a-48de-a06b-b182028cba41" class="code code-wrap"><code>[root@servera ~]# ls -Zd /context
drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /context</code></pre><p id="8ee43dfb-3cd2-44c1-acdc-37dba67561e7" class="">
</p><p id="1b6a0dd8-e4b5-48ee-a813-ed32d753201f" class="">restorecon 명령어로 SELinux 정책에서 컨텍스트 파일 디렉토리에 적용<div class="indented"><ul id="92104e6f-59d5-4adb-bfbb-53c4e1cf7052" class="bulleted-list"><li style="list-style-type:disc"><code>R</code> 옵션 : 하위 디렉토리에 적용</li></ul><ul id="98afd737-34cc-4290-b156-b54bf215c6c6" class="bulleted-list"><li style="list-style-type:disc"><code>F</code> 옵션 : 콘텍스트 재설정</li></ul><ul id="3949654e-5899-46e4-9b95-50e434c27cfe" class="bulleted-list"><li style="list-style-type:disc"><code>v</code> 옵션 : 정보 출력</li></ul></div></p><p id="fbb4ec7f-23e4-43de-8127-94ebd53838fc" class="">
</p><p id="617fe14c-3244-410b-a0fb-01cd3524e2e7" class="">임시적으로 유형 컨텍스트를 변경</p><p id="cdc53bd1-f3c9-4278-8747-65a59839bd1c" class=""><code>chcon -t default_t /context</code></p><pre id="43fcbd71-f021-44a5-9eb4-1cb9ae89b1d1" class="code code-wrap"><code>[root@servera ~]# chcon -t default_t /context
[root@servera ~]# ls -Zd /context
drwxr-xr-x. root root system_u:object_r:default_t:s0   /context</code></pre><p id="ea60fe71-36b7-45ea-9157-1672553dede0" class=""><code>chcon</code>은 런타임 설정 : 재부팅하면 설정이 바뀌거나 사용 도중에 바뀔 수도 있음(권장 X)</p><ul id="761877c2-defd-4b22-bf12-2dbc366e4b3c" class="bulleted-list"><li style="list-style-type:disc">테스트용으로 사용</li></ul><p id="2fc0a289-b269-454d-bcdc-55c9a3631bd0" class="">
</p><h3 id="5511a399-3af9-4291-9c78-a72f75f3925e" class="">SELinux 부울</h3><p id="628ea824-3097-4d0a-8c00-ccbef03696a6" class="">추가적인 기능 설정(스위치처럼 <code>On</code> 또는 <code>Off</code> 설정 가능)</p><p id="3332fd62-25b4-4935-8f91-1709bbbac73e" class="">정책 허용 스위치(접근 시에 기능을 하나하나 체크)</p><p id="e9bb3d76-400b-4ebd-9fca-7c9440be84ce" class="">부울 설정을 하면 유형 컨텍스트가 맞지 않더라도 주체가 객체에 접근할 수있도록 정책의 동작 범위를 수정 가능, 필요한 것만 세팅하는 것이 좋음</p><p id="b74585b7-3b73-4217-a93a-b1076d2ec2e9" class="">
</p><p id="2a8a95b7-3f26-4508-a4aa-4c240a0a09ec" class="">부울 설정 확인</p><p id="c1ccef81-0872-4103-9a0e-a8147e4d3380" class=""><code>getsebool -a</code></p><p id="12cd07d9-6a8e-4937-90c4-fd3afc2260a1" class="">
</p><p id="5976b9dc-c061-40ad-9d06-ab45ad18fa36" class="">부울 설정 확인</p><p id="6fd54f4d-0ae9-461c-abd5-bce3ab9c03e5" class=""><code>semanage boolean -l</code></p><pre id="bf76f5de-af05-47e0-9589-418ffb5b73c7" class="code code-wrap"><code>SELinux boolean                State  Default Description

privoxy_connect_any            (on   ,   on)  Allow privoxy to connect any
...
...
nfs_export_all_ro              (on   ,   on)  Allow nfs to export all ro
cron_can_relabel               (off  ,  off)  Allow cron to can relabel</code></pre><p id="ac4a6982-9981-466d-a5bd-f55d3e70075f" class="">부울의 이름 / 현재 상태 / 영구 설정 상태 / 부울에 대한 설명 순으로 표기</p><p id="8ea45429-a184-4766-919f-e0fee50ec993" class="">
</p><h3 id="ffd91376-d55b-40fb-be65-eeb6bea766d6" class="">부울 설정 변경(현재 상태)</h3><p id="e872a711-fd1a-4790-bdbc-971be82d24c8" class=""><code>httpd_enable_homedirs</code> 초기상태 확인</p><pre id="13252322-3684-484f-a72e-7fa32627ed63" class="code code-wrap"><code>[root@servera ~]# semanage boolean -l | grep httpd_enable_homedirs
httpd_enable_homedirs          (off  ,  off)  Allow httpd to enable homedirs</code></pre><p id="db39f001-b2e1-494b-af89-4c13ad6b0c75" class="">
</p><p id="3862a10a-7cd2-4a5f-b0ee-9e8662880319" class=""><code>setsebool httpd_enable_homedirs on</code> : 설정 변경</p><p id="685e6d78-e95e-4b08-9ef7-461650cee379" class="">확인1 : <code>getsebool httpd_enable_homedirs</code></p><pre id="e8bedbed-b0ef-487c-81be-ecab0e21da59" class="code code-wrap"><code>httpd_enable_homedirs --&gt; off</code></pre><p id="28fbf233-7c79-4ea8-ac53-b332661554b1" class="">
</p><p id="54eb99e3-781f-4821-9825-b5c787a6d4eb" class="">확인2 : <code>semanage boolean -l | grep httpd_enable_homedirs</code></p><pre id="bebc3d39-33a3-43a3-a597-0bbb056b01e9" class="code code-wrap"><code>[root@servera ~]# semanage boolean -l | grep httpd_enable_homedirs
httpd_enable_homedirs          (on   ,  off)  Allow httpd to enable homedirs</code></pre><p id="766aa20e-3ed1-4ef2-8b59-7c113aacda18" class="">현재상태만 변경되고 영구적으로는 변경되지않는다. 그래서 (on, off)</p><p id="ff1f7210-4b72-4220-85dc-6cda272b01d4" class="">
</p><p id="e94fb259-ffa5-4919-aa7b-e45a86446a93" class="">부울 설정 변경(기본 설정)</p><p id="b8b5d57a-be04-4e5a-8a74-e09893eafd0c" class=""><code>setsebool -P httpd_enable_homedirs on</code></p><pre id="4c7cd6ce-00b8-4409-af8f-db5ebc76ba6c" class="code code-wrap"><code>[root@servera ~]# semanage boolean -l | grep httpd_enable_homedirs
httpd_enable_homedirs          (on   ,   on)  Allow httpd to enable homedirs</code></pre><p id="aa0d82db-5a18-49e5-b002-48bc18662dbe" class="">
</p><p id="9553e8f7-6a64-4b16-9c9e-1a44b8061109" class="">부울 설정 변경(현재 상태, 기본 설정)</p><p id="9ab30701-0611-4b54-8222-f0d18a8e0bdd" class=""><code>semanage boolean -m -0 httpd_enable_homedirs</code></p><pre id="27da08aa-0311-4d9e-a358-8b2a31485097" class="code code-wrap"><code>[root@servera ~]# semanage boolean -l | grep httpd_enable_homedirs
httpd_enable_homedirs          (off  ,  off)  Allow httpd to enable homedirs</code></pre><p id="19f7e7d9-6d6c-4d16-877e-f0569c69ba79" class="">
</p><p id="b2b1fec0-78a5-4063-b14b-76661e4717b3" class=""><code>semanage boolean -m -1 httpd_enable_homedirs</code></p><pre id="bc50ee92-15df-430c-904a-d525cd4e45dc" class="code code-wrap"><code>[root@servera ~]# semanage boolean -l | grep httpd_enable_homedirs
httpd_enable_homedirs          (on   ,   on)  Allow httpd to enable homedirs</code></pre><p id="9ccb842b-192e-45ea-b6fa-56961f7553a5" class="">
</p><p id="5341ad88-dac6-4b98-b496-5497b495b0f5" class="">
</p><h1 id="f6a783fe-25e8-4268-ad73-3fdb8720fc2d" class="">selinux 포트 실습</h1><p id="ca98d042-b899-483a-9380-100570e23d20" class=""><code>vim /etc/httpd/conf/httpd.conf</code></p><p id="46ddcbd2-69cd-4e97-9665-aff06aa43166" class="">
</p><pre id="2d1a9ae5-339b-4905-a5a3-896aed6eb58e" class="code code-wrap"><code>...
#Listen 80	# 주석처리
Listen 82		# 추가
...</code></pre><p id="5d666493-1359-499a-9aa2-76cb98824500" class="">
</p><p id="cdf66cd3-1e48-4912-ae0c-ee729c6e43bb" class=""><code>systemctl restart httpd</code></p><pre id="aa8e2df8-514d-4255-89a4-2b42a4e0bedb" class="code code-wrap"><code>[root@servera ~]# systemctl restart httpd
Job for httpd.service failed because the control process exited with error code. See &quot;systemctl status httpd.service&quot; and &quot;journalctl -xe&quot; for details
# 에러 발생</code></pre><p id="ee5a478d-11f5-4a65-a010-cd634512b82e" class="">
</p><p id="b8470aa8-ebae-4757-be2e-c016b603343a" class="">포트번호 확인</p><p id="cd8631f9-8b86-442c-b287-93214fe67dcf" class=""><code>semanage port -l | grep http</code></p><pre id="7f80ee0b-81ac-483a-8bb1-b66f50a80d03" class="code code-wrap"><code>[root@servera ~]# semanage port -l | grep http
http_cache_port_t              tcp      8080, 8118, 8123, 10001-10010
http_cache_port_t              udp      3130
http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000
pegasus_http_port_t            tcp      5988
pegasus_https_port_t           tcp      5989</code></pre><p id="69a89f3c-a91d-4799-9645-e5b0cd4052d8" class="">82번 포트가 등록되어 있지 않음</p><p id="495365ab-efbe-461f-a4e2-78920922c016" class="">
</p><p id="3dc7354c-198c-43d5-96e6-a2145a048cae" class="">82번 포트 등록</p><p id="6eb64dc9-e629-407b-8114-26a6e4584e45" class=""><code>semanage port -a -t http_port_t -p tcp 82</code></p><p id="d187774c-6060-43fd-b076-438a0647fb8f" class=""><code>semanage port -l | grep http</code> 를 통하여 확인</p><pre id="6842e4ab-6199-4a1d-b1d6-941948fcbd97" class="code code-wrap"><code>[root@servera ~]# semanage port -l | grep http
http_cache_port_t              tcp      8080, 8118, 8123, 10001-10010
http_cache_port_t              udp      3130
http_port_t                    tcp      82, 80, 81, 443, 488, 8008, 8009, 8443, 9000 # 82가 추가
pegasus_http_port_t            tcp      5988
pegasus_https_port_t           tcp      5989</code></pre><p id="2b169a81-fcd5-429a-b7cb-14279e2c35b2" class="">
</p><p id="44c953ae-3f4c-4262-98f8-df5c4a9034bf" class="">방화벽 설정</p><p id="2ba26bb0-efea-4e02-978e-559dabe5c82a" class=""><code>firewall-cmd --add-port=82/tcp</code></p><p id="92646a01-78f7-48f8-8646-a8d8adc59581" class=""><code>firewall-cmd --add-port=82/tcp --permanent</code></p><p id="c2b9c0c4-565e-4628-a25c-8f9edd838359" class="">
</p><p id="f0b823ec-c4a2-42f9-810e-7740e5ac3eaa" class="">서비스 재시작</p><p id="d99ce72a-dd35-419f-a224-3c1e57156424" class=""><code>systemctl restart httpd</code></p><p id="78913531-9463-46ab-8b7d-550dffd1b8d2" class="">
</p><p id="979d8286-483f-4121-96cc-78e201edcfbf" class="">브라우저 주소창에 입력 : 192.168.56.10:82</p><figure id="e07c9ccf-88d2-4c59-b7e2-a53705c1bff5" class="image"><a href="SELinux%200e277a5608694feabbd19cbbf27f47c4/Untitled.png"><img style="width:612px" src="SELinux%200e277a5608694feabbd19cbbf27f47c4/Untitled.png"/></a></figure><p id="ee2bc9bf-8c5e-4368-97f7-7e6ffe1fa990" class="">포트 레이블 제거</p><p id="73c1d614-6b25-4ef4-a5db-ea3bf537a445" class=""><code>semanage port -d -t http_port_t -p tcp 82</code></p><p id="4de89a44-8c3a-4d56-a6e2-e6eac8541cc7" class="">포트 바인딩 변경</p><p id="97fe1b74-792f-43d6-aa39-9929b29332a3" class=""><code>semanage port -m -t ftp_port_t -p tcp 82</code></p></div></article></body></html>